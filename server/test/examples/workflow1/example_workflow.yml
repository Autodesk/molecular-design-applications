version: "1"

workflow:

  id: "workflowid"

  nodes:

    - id: node1
      meta:
        name: "Villin Headpiece (1YU8)"
      source: docker
      docker:
        image: 'avirshup/moldesign-obese'
        command: ["python", "-c", "import moldesign as mdt; mol=mdt.from_pdb('1YU8'); mol.write('/outputs/mol.pdb'); mol.write('/outputs/mol.pickle')"]

    #This had problems, I don't know why
    # - id: node2
    #   meta:
    #     name: "Run dynamics (10 ps, 300K)"
    #   source: docker
    #   docker:
    #     image: 'avirshup/moldesign-obese'
    #     command: ["python", "-c", "import moldesign as mdt; mol=mdt.read('/inputs/mol.pickle'); mol.set_integrator(mdt.integrators.OpenMMLangevin); mol.run(10*mdt.units.ps); mol.write('/outputs/mol.pdb'); mol.write('/outputs/mol.pickle')"]

    - id: node3
      meta:
        name: "Assign biomolecular forcefield"
      source: docker
      docker:
        image: 'avirshup/moldesign-obese'
        command: ["python", "-c", "import moldesign as mdt; mol=mdt.read('/inputs/mol.pickle'); mol=mdt.assign_forcefield(mol); mol.set_energy_model(mdt.models.ForceField); mol.write('/outputs/mol.pdb'); mol.write('/outputs/mol.pickle')"]

    - id: node4
      meta: {name: "Build Assembly"}
      source: docker
      docker:
        command: ["python", "-c", "'import moldesign as mdt; mol=mdt.read(''/inputs/mol.pickle''); mol=mdt.Molecule([atom for atom in mol.atoms if atom.residue.type == ''protein'']); mol.write(''/outputs/mol.pdb''); mol.write(''/outputs/mol.pickle'')'"]
        image: avirshup/moldesign-obese

    - id: node5
      meta: {name: "Isolate protein"}
      source: docker
      docker:
        command: ["python", "-c", "'import moldesign as mdt; mol=mdt.read(''/inputs/mol.pickle''); mol=mdt.Molecule([atom for atom in mol.atoms if atom.residue.type == ''dna'']); mol.write(''/outputs/mol.pdb''); mol.write(''/outputs/mol.pickle'')'"]
        image: avirshup/moldesign-obese

    - id: node7
      meta: {name: "Add hydrogen"}
      source: docker
      docker:
        command: ["python", "-c", "import moldesign as mdt; mol=mdt.read('/inputs/mol.pickle'); mol=mdt.assign_forcefield(mol); mol.set_energy_model(mdt.models.ForceField); mol.write('/outputs/mol.pdb'); mol.write('/outputs/mol.pickle')"]
        image: avirshup/moldesign-obese

    - id: node8
      meta: {name: "Assign biomolecular forcefield"}
      source: docker
      docker:
        command: ["python", "-c", "'import moldesign as mdt; mol=mdt.read(''/inputs/mol.pickle''); mol.set_energy_model(mdt.models.GAFF, charges=''gasteiger''); mol.write(''/outputs/mol.pdb''); mol.write(''/outputs/mol.pickle'')'"]
        image: avirshup/moldesign-obese
